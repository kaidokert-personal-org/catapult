{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "7d2cb938_d5d88830",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1170419
      },
      "writtenOn": "2022-02-02T18:28:11Z",
      "side": 1,
      "message": "What about other use cases? What affect will this have on standard chromium gtest / instrumentation tests?",
      "range": {
        "startLine": 14,
        "startChar": 12,
        "endLine": 14,
        "endChar": 32
      },
      "revId": "2e4f398c7b98ffd6f660d588441ee1de664d4597",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "02b2cee8_d7894dab",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1531247
      },
      "writtenOn": "2022-02-02T18:31:07Z",
      "side": 1,
      "message": "Maybe Jamie or Andrew could comment on that as I don\u0027t know, but I also want to add that I\u0027m happy to restructure this in some ways if you could advise on how (making this conditional on some flags etc).",
      "parentUuid": "7d2cb938_d5d88830",
      "range": {
        "startLine": 14,
        "startChar": 12,
        "endLine": 14,
        "endChar": 32
      },
      "revId": "2e4f398c7b98ffd6f660d588441ee1de664d4597",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "81c41653_ec5e22e8",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1531247
      },
      "writtenOn": "2022-02-02T18:42:08Z",
      "side": 1,
      "message": "Also, Andrew mentioned that adb might be already compressing pushes so there might be double-compression going on. I am not sure how to validate that. When I was looking that up I found adb changelog that says _pull_ turned compression to _off_ by default an some point but I\u0027m not sure about push and what\u0027s the distribution of the adb versions in the fleet.\n\nGenerally speaking though, it\u0027s difficult for me to imagine a case where compressing the file would actually matter. Pushing low-entropy files over a slow connection?.. Would that be an actual scenario that can happen nowadays?",
      "parentUuid": "02b2cee8_d7894dab",
      "range": {
        "startLine": 14,
        "startChar": 12,
        "endLine": 14,
        "endChar": 32
      },
      "revId": "2e4f398c7b98ffd6f660d588441ee1de664d4597",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b1fb9703_5e660ba8",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1126674
      },
      "writtenOn": "2022-02-02T18:56:45Z",
      "side": 1,
      "message": "I thought this change made sense, but I don\u0027t have numbers to show it. I thought the main motivation for zipping was to push everything in one adb call as opposed to actually making the files smaller. I think it\u0027s also likely the case that large files constitute the majority of bytes, and that large files are already compressed in some way.\n\nAndroid did add automatic compression for adb push:\nhttps://b.corp.google.com/issues/150827486\n\nI think it works only on devices whose adb server supports it though, and I don\u0027t know which version of android that is.",
      "parentUuid": "81c41653_ec5e22e8",
      "range": {
        "startLine": 14,
        "startChar": 12,
        "endLine": 14,
        "endChar": 32
      },
      "revId": "2e4f398c7b98ffd6f660d588441ee1de664d4597",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "63bb9c44_673331ad",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1531247
      },
      "writtenOn": "2022-02-02T19:19:31Z",
      "side": 1,
      "message": "Thanks for linking the bug, Andrew. lz4 sounds like the perfect option for this. If there was an easy way to flip deflate to lz4 I\u0027d do that, even with double compression that would be blazing fast. Single-threaded deflate, not so much apparently.. Also note how the *de*compression step on the phone also took significantly longer time (60s deflate vs 30s store). I personally am very tempted to just flip the compression off and see if anyone complains. I\u0027m happy to take all the blame ~:}",
      "parentUuid": "b1fb9703_5e660ba8",
      "range": {
        "startLine": 14,
        "startChar": 12,
        "endLine": 14,
        "endChar": 32
      },
      "revId": "2e4f398c7b98ffd6f660d588441ee1de664d4597",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ba5786c5_d1886619",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1170419
      },
      "writtenOn": "2022-02-02T21:11:44Z",
      "side": 1,
      "message": "Native adb compression tried to be utilized in https://chromium-review.googlesource.com/c/catapult/+/3408143, but had to be rolled back due to complications with emualtors IIRC.\n\nAs for the \"land this and see if things break\" approach, I\u0027m not a fan. Rather, please dry-run this on chromium\u0027s CQ before landing (eg https://chromium-review.googlesource.com/c/chromium/src/+/2967505 but for catapult rather than chromite) and see how the android bots handle it.",
      "parentUuid": "63bb9c44_673331ad",
      "range": {
        "startLine": 14,
        "startChar": 12,
        "endLine": 14,
        "endChar": 32
      },
      "revId": "2e4f398c7b98ffd6f660d588441ee1de664d4597",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "756c899c_7bceeb26",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1126674
      },
      "writtenOn": "2022-02-02T21:18:53Z",
      "side": 1,
      "message": "That CL switched to pushing files individually rather than zipping. The problem with it wasn\u0027t compression, but that it added a lot of latency due to having to execute an adb command for every file. This change doesn\u0027t change the number of adb commands.\n\nI agree a dry run is a good idea if it\u0027s easy to do. I didn\u0027t know that was possible!",
      "parentUuid": "ba5786c5_d1886619",
      "range": {
        "startLine": 14,
        "startChar": 12,
        "endLine": 14,
        "endChar": 32
      },
      "revId": "2e4f398c7b98ffd6f660d588441ee1de664d4597",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9dd2b32a_de5bc437",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1126674
      },
      "writtenOn": "2022-02-02T21:19:41Z",
      "side": 1,
      "message": "Note: you can find the \"refs/changes\" by clicking the \"download\" button in gerrit.",
      "parentUuid": "756c899c_7bceeb26",
      "range": {
        "startLine": 14,
        "startChar": 12,
        "endLine": 14,
        "endChar": 32
      },
      "revId": "2e4f398c7b98ffd6f660d588441ee1de664d4597",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a49be3fc_4a8914e1",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1531247
      },
      "writtenOn": "2022-02-02T21:28:36Z",
      "side": 1,
      "message": "Thanks. Sure, CQ Dry run makes sense. I just wasn\u0027t sure how far we\u0027re looking to go with additional validations.\nKicked off https://crrev.com/c/3433905",
      "parentUuid": "9dd2b32a_de5bc437",
      "range": {
        "startLine": 14,
        "startChar": 12,
        "endLine": 14,
        "endChar": 32
      },
      "revId": "2e4f398c7b98ffd6f660d588441ee1de664d4597",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "84d04112_ec0bd742",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1531247
      },
      "writtenOn": "2022-02-02T23:00:15Z",
      "side": 1,
      "message": "CQ passed. Anything else I should be checking for, Ben?",
      "parentUuid": "a49be3fc_4a8914e1",
      "range": {
        "startLine": 14,
        "startChar": 12,
        "endLine": 14,
        "endChar": 32
      },
      "revId": "2e4f398c7b98ffd6f660d588441ee1de664d4597",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4ef3c05e_c1856310",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1126674
      },
      "writtenOn": "2022-02-03T02:00:07Z",
      "side": 1,
      "message": "Spot-checked one test data push from the CQ:\nchrome_public_test_vr_apk \nhttps://ci.chromium.org/ui/p/chromium/builders/try/android-marshmallow-arm64-rel/1073716/overview\nvs\nhttps://ci.chromium.org/ui/p/chromium/builders/try/android-marshmallow-arm64-rel/1074008/overview\n\nWithout this change: 154 seconds\nI  114.366s TimeoutThread-1-for-individual_device_set_up(01e158d01cafac02)  Pushing 6237 files via .zip of size 156768723\nI  166.284s individual_device_set_up(01e158d01cafac02)  Still working on PushChangedFiles(...)\nI  226.367s individual_device_set_up(01e158d01cafac02)  Still working on PushChangedFiles(...)\nI  259.806s individual_device_set_up(01e158d01cafac02)  Flags now written on the device to /data/local/tmp/test-cmdline-file\nI  259.806s individual_device_set_up(01e158d01cafac02)  Flags: [\u0027--enable-test-intents\u0027]\n\nWith this change: 141 seconds\nI  116.516s TimeoutThread-1-for-individual_device_set_up(01e7f67dca40424a)  Pushing 6237 files via .zip of size 270725985\nI  174.928s individual_device_set_up(01e7f67dca40424a)  Still working on PushChangedFiles(...)\nI  235.010s individual_device_set_up(01e7f67dca40424a)  Still working on PushChangedFiles(...)\nI  256.004s individual_device_set_up(01e7f67dca40424a)  Flags now written on the device to /data/local/tmp/test-cmdline-file\n\nAlthough faster, the file size increase is more than I would have thought (156768723 -\u003e 270725985). But, it is faster :).",
      "parentUuid": "84d04112_ec0bd742",
      "range": {
        "startLine": 14,
        "startChar": 12,
        "endLine": 14,
        "endChar": 32
      },
      "revId": "2e4f398c7b98ffd6f660d588441ee1de664d4597",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2722a111_17e55722",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 14,
      "author": {
        "id": 1531247
      },
      "writtenOn": "2022-02-03T22:15:05Z",
      "side": 1,
      "message": "Thanks for checking! Yeah, I think something like lz4 straight into the pipe without any temporary files would be best but that\u0027s way more complicated than this cl for uncertain benefit.",
      "parentUuid": "4ef3c05e_c1856310",
      "range": {
        "startLine": 14,
        "startChar": 12,
        "endLine": 14,
        "endChar": 32
      },
      "revId": "2e4f398c7b98ffd6f660d588441ee1de664d4597",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}