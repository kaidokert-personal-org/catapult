{
  "comments": [
    {
      "key": {
        "uuid": "3a5ed676_a08f919b",
        "filename": "telemetry/telemetry/internal/platform/tracing_agent/perfetto_tracing_agent.py",
        "patchSetId": 7
      },
      "lineNbr": 44,
      "author": {
        "id": 1322871
      },
      "writtenOn": "2019-12-05T10:59:25Z",
      "side": 1,
      "message": "Remove duration_ms since we\u0027ll use a trigger config instead.\n\ntrigger_config: {\n  trigger_mode: STOP_TRACING\n  triggers: {\n    name: \"stop_chrome_trace_any_string_you_want\"\n    stop_delay_ms: 0\n  }\n  trigger_timeout_ms: \u003cmaximum time you are willing to have a trace go for\u003e\n}\n\nThen add a new \"trace config\" that only has the exact trigger string you defined above. I.E.\n\n_TRIGGER_CONFIG \u003d \"\"\"\nactivate_triggers \u003d \"stop_chrome_trace_any_string_you_want\"\n\"\"\"\n\nThen rather then SIGINT send\n\ncmd \u003d [self.PERFETTO_BIN, \u0027--config\u0027, _TRIGGER_CONFIG]\n\nThough you\u0027ll need to convert _TRIGGER_CONFIG the same way you do _TRACE_CONFIG.",
      "revId": "a113fa237aa39d816356b171d4066defb939d7fb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "29cc26a6_bcdd33f0",
        "filename": "telemetry/telemetry/internal/platform/tracing_agent/perfetto_tracing_agent.py",
        "patchSetId": 7
      },
      "lineNbr": 44,
      "author": {
        "id": 1322871
      },
      "writtenOn": "2019-12-05T11:01:58Z",
      "side": 1,
      "message": "Actually I think they added a helper binary that is simpler to use \n\nhttps://cs.corp.google.com/aosp-android10/external/perfetto/src/perfetto_cmd/trigger_perfetto.cc?g\u003d0\n\nSo you should be able to install the \"trigger_perfetto\" binary and then just do\n\ncmd \u003d [self.TRIGGER_PERFETTO_BIN, \u0027stop_chrome_any_string_you_want\"]",
      "parentUuid": "3a5ed676_a08f919b",
      "revId": "a113fa237aa39d816356b171d4066defb939d7fb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "26d0c990_5fb45b67",
        "filename": "telemetry/telemetry/internal/platform/tracing_agent/perfetto_tracing_agent.py",
        "patchSetId": 7
      },
      "lineNbr": 44,
      "author": {
        "id": 1123010
      },
      "writtenOn": "2019-12-05T13:35:30Z",
      "side": 1,
      "message": "Thanks! Done.\n\nAlthough somehow the trace still comes out empty when I load it into Perfetto UI :(\n\nMaybe I\u0027m missing something else?",
      "parentUuid": "29cc26a6_bcdd33f0",
      "revId": "a113fa237aa39d816356b171d4066defb939d7fb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d7183de7_e1064dde",
        "filename": "telemetry/telemetry/internal/platform/tracing_agent/perfetto_tracing_agent.py",
        "patchSetId": 7
      },
      "lineNbr": 44,
      "author": {
        "id": 1322871
      },
      "writtenOn": "2019-12-05T14:45:27Z",
      "side": 1,
      "message": "Do you have the final trace config sent to the device in any logs somewhere?\n\nWhere are you setting up the sockets? are they at /dev/socket/traced_producer ? or somewhere else?\n\nI think the default is /dev/socket/traced_producer unless you provide a different location which I don\u0027t see here.\n\nDo you have a trace file? Is it actually empty? or are there some packets? but nothing shows in the UI?",
      "parentUuid": "26d0c990_5fb45b67",
      "revId": "a113fa237aa39d816356b171d4066defb939d7fb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "27052665_49227c22",
        "filename": "telemetry/telemetry/internal/platform/tracing_agent/perfetto_tracing_agent.py",
        "patchSetId": 7
      },
      "lineNbr": 44,
      "author": {
        "id": 1123010
      },
      "writtenOn": "2019-12-05T17:44:15Z",
      "side": 1,
      "message": "Yeah, I\u0027m not setting up any sockets anywhere. Where do I do that?\n\nHere I pasted logs and the proto file I\u0027m getting out:\nhttps://perezju.users.x20web.corp.google.com/www/system_tracing/\n\nThe logs show the trace config written, as well as the loooong command line passed to Chrome. Do I have to tweak either of those?",
      "parentUuid": "d7183de7_e1064dde",
      "revId": "a113fa237aa39d816356b171d4066defb939d7fb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cadad17d_bf0a3b0f",
        "filename": "telemetry/telemetry/internal/platform/tracing_agent/perfetto_tracing_agent.py",
        "patchSetId": 7
      },
      "lineNbr": 44,
      "author": {
        "id": 1322871
      },
      "writtenOn": "2019-12-06T10:19:29Z",
      "side": 1,
      "message": "I believe be default if you aren\u0027t doing anything then it should be there at /dev/socket. here is the logic for setting up sockets [1]. There are some environment variables but I doubt they are being set in our test so we need the device logcat to see if the service is properly starting.\n\nSo the trace you linked only has 3 packets that aren\u0027t from the service in it. So doesn\u0027t look like Chrome ever connected.\n\nHere is the full trace fed through trace_to_text [2] https://paste.googleplex.com/4869990056460288\n\nThe trace config looks a bit weird because it has new lines in it but seems to work fine. Also duration_ms is still in the example trace config there the trace won\u0027t start if duration_ms is also there because it will error off (but not sure how you got a trace with packets at all?). You should only set on of |duration_ms| and |trigger_timeout_ms|.\n\nThose logs are of the telemetry run. Do you have the logcat of the device?\n\nAfter running this trace config [3] manually (minus duration_ms) on my R device this worked with Chrome Canary.\n\n[1] https://cs.chromium.org/chromium/src/third_party/perfetto/src/traced/service/service.cc?l\u003d66\u0026rcl\u003d9cec36038932a51e3c547f813fd37cb8c3cce6f9\n[2] out/linux_clang_debug/trace_to_text text ~/Downloads/tmpUCHcM6.pb | less\n[3] https://paste.googleplex.com/6340889746079744",
      "parentUuid": "27052665_49227c22",
      "revId": "a113fa237aa39d816356b171d4066defb939d7fb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a81a1c69_9f47bf2f",
        "filename": "telemetry/telemetry/internal/platform/tracing_agent/perfetto_tracing_agent.py",
        "patchSetId": 7
      },
      "lineNbr": 75,
      "author": {
        "id": 1322871
      },
      "writtenOn": "2019-12-05T10:59:25Z",
      "side": 1,
      "message": "Is this trying to kill any previous running binaries?\n\nWhat about the system? won\u0027t this not work for anything P+ pixel device and R+ device with it enabled by default?",
      "revId": "a113fa237aa39d816356b171d4066defb939d7fb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bb030ef0_f7a3b4ca",
        "filename": "telemetry/telemetry/internal/platform/tracing_agent/perfetto_tracing_agent.py",
        "patchSetId": 7
      },
      "lineNbr": 75,
      "author": {
        "id": 1123010
      },
      "writtenOn": "2019-12-05T13:35:30Z",
      "side": 1,
      "message": "I\u0027ve added a version check to skip this on newer versions. We can also later tweak it as needed.",
      "parentUuid": "a81a1c69_9f47bf2f",
      "revId": "a113fa237aa39d816356b171d4066defb939d7fb",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}