<!DOCTYPE html>
<!--
Copyright 2019 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<link rel="import" href="/tracing/value/histogram_serializer.html">

<script>
'use strict';

tr.b.unittest.testSuite(function() {
  test('serialize', function() {
    const hist = new tr.v.Histogram(
        'aaa', tr.b.Unit.byName.count_biggerIsBetter);
    hist.diagnostics.set('bbb', new tr.v.d.RelatedNameMap({
      ccc: 'a:c',
      ddd: 'a:d',
    }));
    hist.diagnostics.set('hhh', new tr.v.d.GenericSet(['ggg']));
    hist.addSample(0, {
      bbb: tr.v.d.Breakdown.fromEntries([
        ['ccc', 11],
        ['ddd', 31],
      ]),
      eee: new tr.v.d.RelatedEventSet([
        new tr.v.d.EventRef({
          stableId: 'fff',
          title: 'ggg',
          start: 3,
          duration: 4,
        }),
      ]),
    });

    assert.deepEqual(tr.v.HistogramSerializer.serialize([hist]), [
      [
        'aaa',
        [1, [1, 1000, 20]],
        '',
        'ccc',
        'ddd',
        [3, 4],
        'a:c',
        'a:d',
        'ggg'
      ],
      {
        'RelatedNameMap': {
          'bbb': {
            '0': [7, 3, 4]
          }
        },
        'GenericSet': {
          'hhh': {
            '1': 8
          }
        },
        'Breakdown': {
          'bbb': {
            '2': [2, 7, 11, 31]
          }
        },
        'RelatedEventSet': {
          'eee': {
            '3': [
              ['fff', 8, 3, 4]
            ]
          }
        }
      },
      [
        0,
        'count+',
        1,
        2,
        [0, 1],
        [1, 0, undefined, 0, 0, 0, 0],
        {
          '0': [
            1,
            [undefined, 2, 3]
          ]
        },
        0
      ]
    ]);
  });
});
</script>
