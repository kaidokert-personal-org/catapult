<!DOCTYPE html>
<!--
Copyright 2019 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<link rel="import" href="/tracing/extras/chrome/screenshots_based_speed_index.html">

<script>
'use strict';

tr.b.unittest.testSuite(function() {
  test('getSnapshotsProgress', function() {
    // Initially, screenshot consists of 3 white pixels.
    const firstScreenshot = [255, 255, 255, 255,
      255, 255, 255, 255,
      255, 255, 255, 255];
    // One red pixel, 2 white pixels.
    const secondScreenshot = [255, 0, 0, 255,
      255, 255, 255, 255,
      255, 255, 255, 255];
    // One red pixel, one green pixel and one white pixel.
    const thirdScreenshot = [255, 0, 0, 255,
      0, 255, 0, 255,
      255, 255, 255, 255];
    // One red pixel, one green pixel and one blue pixel.
    const fourthScreenshot = [255, 0, 0, 255,
      0, 255, 0, 255,
      0, 0, 255, 255];

    const screenshots = new Array(4);
    screenshots[0] = firstScreenshot;
    screenshots[1] = secondScreenshot;
    screenshots[2] = thirdScreenshot;
    screenshots[3] = fourthScreenshot;

    const timeStamps = [100, 200, 300, 400];
    assert.deepEqual([{value: 0, ts: 100}, {value: 1 / 3, ts: 200},
      {value: 2 / 3, ts: 300}, {value: 1, ts: 400}],
    tr.e.chrome.getSnapshotsProgress(screenshots, timeStamps));
  });

  test('calculateSpeedIndex', function() {
    const speedIndex = tr.e.chrome.calculateSpeedIndex(
        [{value: 0, ts: 100}, {value: 0.5, ts: 200}, {value: 1.0, ts: 300}]);
    assert.strictEqual(250, speedIndex);
  });

  test('createColorHistogram', function() {
    const colorHistogram =
    tr.e.chrome.createColorHistogram([255, 0, 0, 255,
      0, 255, 0, 255,
      0, 0, 255, 255,
      255, 255, 0, 255]);
    const histogram = new Array(3);
    for (let i = 0; i < 3; i++) {
      histogram[i] = new Array(256).fill(0.0);
    }
    // Update red channel values.
    histogram[0][255] = 2;
    histogram[0][0] = 2;
    // Update green channel values.
    histogram[1][255] = 2;
    histogram[1][0] = 2;
    // Update blue channel values.
    histogram[2][255] = 1;
    histogram[2][0] = 3;

    assert.deepEqual(histogram, colorHistogram);
  });
});
</script>
