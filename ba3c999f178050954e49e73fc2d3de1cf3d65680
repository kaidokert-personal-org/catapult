{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "5a7a6c41_8f399268",
        "filename": "devil/bin/run_py3_tests",
        "patchSetId": 13
      },
      "lineNbr": 21,
      "author": {
        "id": 1170419
      },
      "writtenOn": "2021-03-17T23:50:47Z",
      "side": 1,
      "message": "Are you positive that these tests are run when invoking `./bin/run_py3_tests` ?",
      "revId": "ba3c999f178050954e49e73fc2d3de1cf3d65680",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fdbbd587_8ad7eca7",
        "filename": "devil/bin/run_py3_tests",
        "patchSetId": 13
      },
      "lineNbr": 21,
      "author": {
        "id": 1476473
      },
      "writtenOn": "2021-03-18T01:01:58Z",
      "side": 1,
      "message": "It says \"Ran 0 tests\". I would say make cmd_helper_test pass under run_py3_tests should not be part of this CL. There are other tests inside cmd_helper_test, and those tests are not written with py3 in mind.",
      "parentUuid": "5a7a6c41_8f399268",
      "revId": "ba3c999f178050954e49e73fc2d3de1cf3d65680",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0a095d6f_4015761a",
        "filename": "devil/bin/run_py3_tests",
        "patchSetId": 13
      },
      "lineNbr": 21,
      "author": {
        "id": 1167294
      },
      "writtenOn": "2021-03-18T17:17:21Z",
      "side": 1,
      "message": "Hmmm that doesn\u0027t seem right. It would be great if we could get this test running under py3 so we can validate the changes here. How many tests fail if you get this running under py3?",
      "parentUuid": "fdbbd587_8ad7eca7",
      "revId": "ba3c999f178050954e49e73fc2d3de1cf3d65680",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "38759c9f_6b5c89aa",
        "filename": "devil/bin/run_py3_tests",
        "patchSetId": 13
      },
      "lineNbr": 21,
      "author": {
        "id": 1476473
      },
      "writtenOn": "2021-03-18T17:47:34Z",
      "side": 1,
      "message": "I don\u0027t know. If I run \"vpython3 run_py_test cmd_helper_tests.py\" it did report some errors. I would say it is not this CL\u0027s intention to make cmd_helper.py completely py3 compatible. This should be covered by 1007101 (and that is my job). I would suggest we get this CL in asap, so that I can move on to next task, and that actually make things move faster.",
      "parentUuid": "0a095d6f_4015761a",
      "revId": "ba3c999f178050954e49e73fc2d3de1cf3d65680",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4982b240_b0739079",
        "filename": "devil/bin/run_py3_tests",
        "patchSetId": 13
      },
      "lineNbr": 21,
      "author": {
        "id": 1181690
      },
      "writtenOn": "2021-03-18T18:28:26Z",
      "side": 1,
      "message": "to make this work, you don\u0027t want the string, you want the module itself, e.g.\n\n  import devil.utils.cmd_helper_test\n\n  PY3_COMPATIBLE_TESTS \u003d [\n    devil.utils.cmd_helper_test\n  ]",
      "parentUuid": "38759c9f_6b5c89aa",
      "revId": "ba3c999f178050954e49e73fc2d3de1cf3d65680",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "73e864bb_3c2c45ca",
        "filename": "devil/bin/run_py3_tests",
        "patchSetId": 13
      },
      "lineNbr": 21,
      "author": {
        "id": 1476473
      },
      "writtenOn": "2021-03-18T18:43:59Z",
      "side": 1,
      "message": "I actually tried this yesterday, without the import, it does not work. Tried again just now with the import, still does not work. It complains:\nTraceback (most recent call last):\n  File \"./devil/bin/run_py3_tests\", line 12, in \u003cmodule\u003e\n    import devil.utils.cmd_helper_test\nModuleNotFoundError: No module named \u0027devil\u0027",
      "parentUuid": "4982b240_b0739079",
      "revId": "ba3c999f178050954e49e73fc2d3de1cf3d65680",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "467aeb0f_eef924be",
        "filename": "devil/bin/run_py3_tests",
        "patchSetId": 13
      },
      "lineNbr": 21,
      "author": {
        "id": 1181690
      },
      "writtenOn": "2021-03-18T18:48:31Z",
      "side": 1,
      "message": "ah, oops. need to also add\n\n  _DEVIL_PATH \u003d os.path.abspath(os.path.join(os.path.dirname(__file__), \u0027..\u0027))\n\n  sys.path.append(_DEVIL_PATH)\n\n(which I should\u0027ve done when landing run_py3_tests)",
      "parentUuid": "73e864bb_3c2c45ca",
      "revId": "ba3c999f178050954e49e73fc2d3de1cf3d65680",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9c0b2801_44a9c94f",
        "filename": "devil/bin/run_py3_tests",
        "patchSetId": 13
      },
      "lineNbr": 21,
      "author": {
        "id": 1476473
      },
      "writtenOn": "2021-03-18T19:10:59Z",
      "side": 1,
      "message": "Find you actually add that in the code. It is my bad to put the import at a wrong place. Fixing that now the test runs, but with below error:\nERROR: testIterCmdOutputLines_delay (devil.utils.cmd_helper_test.CmdHelperIterCmdOutputLinesTest)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/usr/local/google/code/chromium/src/third_party/catapult/devil/devil/utils/cmd_helper_test.py\", line 265, in testIterCmdOutputLines_delay\n    for num, line in enumerate(\n  File \"/usr/local/google/code/chromium/src/third_party/catapult/devil/devil/utils/cmd_helper.py\", line 573, in _IterCmdOutputLines\n    for data in _IterProcessStdout(\n  File \"/usr/local/google/code/chromium/src/third_party/catapult/devil/devil/utils/cmd_helper.py\", line 357, in _IterProcessStdoutFcntl\n    data \u003d _read_and_decode(child_fd, buffer_size)\n  File \"/usr/local/google/code/chromium/src/third_party/catapult/devil/devil/utils/cmd_helper.py\", line 321, in _read_and_decode\n    data \u003d data.decode(\u0027utf-8\u0027, errors\u003d\u0027ignore\u0027)\nAttributeError: \u0027str\u0027 object has no attribute \u0027decode\u0027\n\nI believe this is due to the Mock in the unit test is wrong. Because from py3 document, os.read always returns bytestring:\nos.read(fd, n)\nRead at most n bytes from file descriptor fd.\n\nReturn a bytestring containing the bytes read. If the end of the file referred to by fd has been reached, an empty bytes object is returned\n\nI suggest we go ahead with this change, leave the fix for the unittest for future.",
      "parentUuid": "467aeb0f_eef924be",
      "revId": "ba3c999f178050954e49e73fc2d3de1cf3d65680",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e3a6b2a9_ef61e2a1",
        "filename": "devil/bin/run_py3_tests",
        "patchSetId": 13
      },
      "lineNbr": 21,
      "author": {
        "id": 1476473
      },
      "writtenOn": "2021-03-18T19:20:21Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9c0b2801_44a9c94f",
      "revId": "ba3c999f178050954e49e73fc2d3de1cf3d65680",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b84949d3_49ba6769",
        "filename": "devil/devil/android/md5sum.py",
        "patchSetId": 13
      },
      "lineNbr": 9,
      "author": {
        "id": 1167294
      },
      "writtenOn": "2021-03-17T23:42:17Z",
      "side": 1,
      "message": "nit: alphabetical",
      "range": {
        "startLine": 8,
        "startChar": 0,
        "endLine": 9,
        "endChar": 9
      },
      "revId": "ba3c999f178050954e49e73fc2d3de1cf3d65680",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a8905841_9075c194",
        "filename": "devil/devil/android/md5sum.py",
        "patchSetId": 13
      },
      "lineNbr": 9,
      "author": {
        "id": 1476473
      },
      "writtenOn": "2021-03-18T01:01:58Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b84949d3_49ba6769",
      "range": {
        "startLine": 8,
        "startChar": 0,
        "endLine": 9,
        "endChar": 9
      },
      "revId": "ba3c999f178050954e49e73fc2d3de1cf3d65680",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f858b6c6_40578a8d",
        "filename": "devil/devil/utils/cmd_helper.py",
        "patchSetId": 13
      },
      "lineNbr": 400,
      "author": {
        "id": 1167294
      },
      "writtenOn": "2021-03-17T23:42:17Z",
      "side": 1,
      "message": "If decoding is important, how about moving this logic into a helper function? Then we can just replace \"os.read\" calls with the helper method.",
      "range": {
        "startLine": 398,
        "startChar": 8,
        "endLine": 400,
        "endChar": 70
      },
      "revId": "ba3c999f178050954e49e73fc2d3de1cf3d65680",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5285a8e2_6d6f46c7",
        "filename": "devil/devil/utils/cmd_helper.py",
        "patchSetId": 13
      },
      "lineNbr": 400,
      "author": {
        "id": 1476473
      },
      "writtenOn": "2021-03-18T01:01:58Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f858b6c6_40578a8d",
      "range": {
        "startLine": 398,
        "startChar": 8,
        "endLine": 400,
        "endChar": 70
      },
      "revId": "ba3c999f178050954e49e73fc2d3de1cf3d65680",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}