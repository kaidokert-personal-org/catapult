{
  "comments": [
    {
      "key": {
        "uuid": "94cb6391_e5f9400b",
        "filename": "dashboard/dashboard/elements/autocomplete-box.html",
        "patchSetId": 2
      },
      "lineNbr": 416,
      "author": {
        "id": 1116018
      },
      "writtenOn": "2017-10-12T16:49:06Z",
      "side": 1,
      "message": "Not super familiar with inner workings of autocomplete-box or test-picker, will ping you offline for a quick walkthrough.",
      "range": {
        "startLine": 416,
        "startChar": 30,
        "endLine": 416,
        "endChar": 42
      },
      "revId": "597777596cd98d1fd7c4b3ad903703f91699e671",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c6d76ba1_3084fdb7",
        "filename": "dashboard/dashboard/elements/test-picker.html",
        "patchSetId": 2
      },
      "lineNbr": 376,
      "author": {
        "id": 1115874
      },
      "writtenOn": "2017-10-14T06:35:51Z",
      "side": 1,
      "message": "I removed this because natorion wants to be able to change early components without needing to re-select later components. https://github.com/catapult-project/catapult/issues/3965#issuecomment-336371433",
      "revId": "597777596cd98d1fd7c4b3ad903703f91699e671",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e98f8e8f_d780910e",
        "filename": "dashboard/dashboard/elements/test-picker.html",
        "patchSetId": 2
      },
      "lineNbr": 376,
      "author": {
        "id": 1116018
      },
      "writtenOn": "2017-10-16T18:35:41Z",
      "side": 1,
      "message": "Is this an extra fix for a different bug? I\u0027m having trouble reproducing the issue in 3965, what are the steps?",
      "parentUuid": "c6d76ba1_3084fdb7",
      "revId": "597777596cd98d1fd7c4b3ad903703f91699e671",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a1d29ee0_b508855b",
        "filename": "dashboard/dashboard/elements/test-picker.html",
        "patchSetId": 2
      },
      "lineNbr": 376,
      "author": {
        "id": 1115874
      },
      "writtenOn": "2017-10-19T20:35:38Z",
      "side": 1,
      "message": "3965 is the same bug as 3963.\nI asked natorion to check that this CL (clearing autocomplete-box\u0027s selectedItem when its query is cleared) fixes his issue.\nHe replied that it does, except, when he clears the Bot autocomplete-box, it also automatically clears all subtests, which makes it difficult to select the same metric between different Bots.\nThe repro steps are to 1. select a full test-path, 2. clear the Bot autocomplete-box, 3. observe that subtest menus are cleared.\nThis branch in updateBotMenu is what was clearing subtests when the Bot menu was cleared. I removed this branch so that natorion can select the same metric between different bots.\nBefore this CL cleared autocomplete-box\u0027s selectedItem, this branch was dead code (afaict), and was not causing a problem.",
      "parentUuid": "e98f8e8f_d780910e",
      "revId": "597777596cd98d1fd7c4b3ad903703f91699e671",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "77b06e0c_ae2bb3c8",
        "filename": "dashboard/dashboard/elements/test-picker.html",
        "patchSetId": 2
      },
      "lineNbr": 586,
      "author": {
        "id": 1115874
      },
      "writtenOn": "2017-10-14T06:35:51Z",
      "side": 1,
      "message": "I backed out the changes to test-picker and added a console.trace to debug.\n\nFirst, it should be noted that the test-picker works completely fine from the user\u0027s point of view without this added `if (menu.selectedItem)`, but prints a TypeError to the console. That suggests that test-picker is sometimes trying to do something that it doesn\u0027t strictly need to do.\n\nWhen autocomplete-box.onQueryChanged_ sets selectedItem, polymer calls the observer selectedItemChanged, which fires the \u0027dropdownselect\u0027 event (containing the index of the autocomplete-box in the test-picker as event.model.index) up to test-picker\u0027s onDropdownSelect listener, which calls updateSubtestMenus, which calls getCurrentSelectedPathUpTo (this method).\nBasically, test-picker assumes that the \u0027dropdownselect\u0027 event implies that the indicated autocomplete-box\u0027s selectedItem is defined, because the dropdown menu never contains undefined.\nThe confusion seems to be rooted in how the \"selectedItemChanged\" message (which happens whenever the selectedItem changes, even if it is programmatically changed to undefined) fires a \"dropdownselect\" event, which implies that the user selected a definite item from the menu.\n\nPerhaps test-picker should bail out of that call-chain (onDropdownSelect -\u003e updateSubtestMenus -\u003e getCurrentSelectedPathUpTo) at some point before getCurrentSelectedPathUpTo is called.\nI changed onDropdownSelect to not call updateSubtestMenus if the changed menu does not have a selectedItem, and that fixed the TypeErrors when clearing autocomplete-boxes after the zeroth, but I still saw a TypeError at `const suite \u003d this.getSelectionMenu(0).selectedItem.name;` when I cleared the zeroth autocomplete-box, so I added that guard back in.",
      "revId": "597777596cd98d1fd7c4b3ad903703f91699e671",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "55289f0b_12bf33bb",
        "filename": "dashboard/dashboard/elements/test-picker.html",
        "patchSetId": 2
      },
      "lineNbr": 586,
      "author": {
        "id": 1116018
      },
      "writtenOn": "2017-10-16T18:35:41Z",
      "side": 1,
      "message": "Thanks for digging a bit deeper on this, that at least clears up understanding of the call stack that leads here.\n\nSo I\u0027m still a bit unclear what this function is used for in test-picker. Who are the callers, what\u0027s the return value used for, is it ok for part of the path to be missing? It kinda seems in general that test-picker isn\u0027t written for chunks of the test path to be missing.",
      "parentUuid": "77b06e0c_ae2bb3c8",
      "revId": "597777596cd98d1fd7c4b3ad903703f91699e671",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b7ad5bc1_8d7228ca",
        "filename": "dashboard/dashboard/elements/test-picker.html",
        "patchSetId": 2
      },
      "lineNbr": 586,
      "author": {
        "id": 1115874
      },
      "writtenOn": "2017-10-19T20:35:38Z",
      "side": 1,
      "message": "getCurrentSelectedPathUpTo is only called in test-picker.\ngetCurrentSelection calls getCurrentSelectedPathUpTo(-1, true) to collect the full selected test-path.\n\nupdateSubtestMenus takes a |startIndex| and calls getCurrentSelectedPathUpTo 3 times:\n1 and 2: with startIndex and (i+1) in a loop to get the selected path up to |startIndex| so that it can call /list_tests via subtests.get() and update subtest menus.\n3: getCurrentSelectedPathUpTo(0) to get the test-suite-level test-path in order to fetch the story tag map.\n\nonDropdownSelect also calls getCurrentSelectedPathUpTo(0) to get the test-suite-level test-path in order to fetch the story tag map.\n\nSorry, I\u0027m not sure what you mean about missing chunks of the test-path.",
      "parentUuid": "55289f0b_12bf33bb",
      "revId": "597777596cd98d1fd7c4b3ad903703f91699e671",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}