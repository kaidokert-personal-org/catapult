{
  "comments": [
    {
      "key": {
        "uuid": "ee2cc023_b43d55e1",
        "filename": "devil/devil/android/apk_helper.py",
        "patchSetId": 1
      },
      "lineNbr": 21,
      "author": {
        "id": 1154589
      },
      "writtenOn": "2019-02-13T16:56:35Z",
      "side": 1,
      "message": "I\u0027m not sure if it\u0027s kosher to import from build/android/gyp, WDYT?",
      "range": {
        "startLine": 21,
        "startChar": 0,
        "endLine": 21,
        "endChar": 2
      },
      "revId": "d0071ded879eea94d26aafb348326a9cf3449dbd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "77e3d306_0536b20f",
        "filename": "devil/devil/android/apk_helper.py",
        "patchSetId": 1
      },
      "lineNbr": 21,
      "author": {
        "id": 1123010
      },
      "writtenOn": "2019-02-14T12:48:09Z",
      "side": 1,
      "message": "Yeah, this doesn\u0027t look great. It looks like you only need this to find BUNDLETOOL_JAR_PATH and run a command with that. But also that\u0027s what src/build/android/gyp/bundletool.py already does for you.\n\nMaybe just call that as an external script?",
      "parentUuid": "ee2cc023_b43d55e1",
      "range": {
        "startLine": 21,
        "startChar": 0,
        "endLine": 21,
        "endChar": 2
      },
      "revId": "d0071ded879eea94d26aafb348326a9cf3449dbd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1755f2f8_ee725910",
        "filename": "devil/devil/android/apk_helper.py",
        "patchSetId": 1
      },
      "lineNbr": 21,
      "author": {
        "id": 1154589
      },
      "writtenOn": "2019-02-15T10:43:15Z",
      "side": 1,
      "message": "OK, done. I\u0027m still depending on build/android/gyp existing, which may still not be totally right. \n\nIt seems that devil_env.py and devil_dependencies.json want to download tools to devil/bin/deps/ rather than assume that catapult is embedded in the chromium tree. It seems wasteful to make an additional copy of bundletools and incur the maintenance cost of updating that, than using the one in build/gyp, when (AFAIK) the only use for this is going to be when running inside of a chromium tree.\n\nAny advice appreciated :)",
      "parentUuid": "77e3d306_0536b20f",
      "range": {
        "startLine": 21,
        "startChar": 0,
        "endLine": 21,
        "endChar": 2
      },
      "revId": "d0071ded879eea94d26aafb348326a9cf3449dbd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "084b308e_e5017540",
        "filename": "devil/devil/android/apk_helper.py",
        "patchSetId": 1
      },
      "lineNbr": 21,
      "author": {
        "id": 1123010
      },
      "writtenOn": "2019-02-15T10:53:07Z",
      "side": 1,
      "message": "I think this is probably fine.\n\n+jbudorick anyway in case you have any thoughts on how to better do this? (please see latest patchset).",
      "parentUuid": "1755f2f8_ee725910",
      "range": {
        "startLine": 21,
        "startChar": 0,
        "endLine": 21,
        "endChar": 2
      },
      "revId": "d0071ded879eea94d26aafb348326a9cf3449dbd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "944d1ebb_688a0d4d",
        "filename": "devil/devil/android/apk_helper.py",
        "patchSetId": 1
      },
      "lineNbr": 21,
      "author": {
        "id": 1181690
      },
      "writtenOn": "2019-02-15T16:53:20Z",
      "side": 1,
      "message": "eeeeep, I would strongly prefer to avoid devil depending on chromium like this. If devil needs to use bundletool, the script should move up to devil and the binary dependency should be handled via devil\u0027s existing dependency system. I know it\u0027s not ideal, and I\u0027ve been meaning to rewrite it for a while, but it should still be used for now.\n\nWhen devil is embedded within the chromium tree, it can pick up replacements for different binaries as specified in https://codesearch.chromium.org/chromium/src/build/android/devil_chromium.json. https://codesearch.chromium.org/chromium/src/build/android/devil_chromium.py?rcl\u003d4d5bb65128b10c95568876f74a700c1235511a6e\u0026l\u003d110 injects those into devil_env.",
      "parentUuid": "084b308e_e5017540",
      "range": {
        "startLine": 21,
        "startChar": 0,
        "endLine": 21,
        "endChar": 2
      },
      "revId": "d0071ded879eea94d26aafb348326a9cf3449dbd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e98da102_3a7c7655",
        "filename": "devil/devil/android/apk_helper.py",
        "patchSetId": 1
      },
      "lineNbr": 21,
      "author": {
        "id": 1154589
      },
      "writtenOn": "2019-02-15T17:44:21Z",
      "side": 1,
      "message": "Okay. See also https://chromium-review.googlesource.com/c/catapult/+/1470852, which needs keystore stuff to sign the apk prior to installing (also in apk_helper.py). I assume that also makes you very uncomfortable as well, John ;)\n\nOr, I wonder if in that case it would be better to assume/plumb through the existence of bin/monochrome_64_bundle (corresponding to Monochrome64.aab, with similar mappings for other bundle targets), which knows how to install itself.\n\nI think we still need bundletool, though, as devil/telemetry needs to examine the manifest of the application which is different in a bundle.",
      "parentUuid": "944d1ebb_688a0d4d",
      "range": {
        "startLine": 21,
        "startChar": 0,
        "endLine": 21,
        "endChar": 2
      },
      "revId": "d0071ded879eea94d26aafb348326a9cf3449dbd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c4900948_5db9dbb7",
        "filename": "devil/devil/android/apk_helper.py",
        "patchSetId": 1
      },
      "lineNbr": 21,
      "author": {
        "id": 1181690
      },
      "writtenOn": "2019-02-15T18:02:02Z",
      "side": 1,
      "message": "\u003e Okay. See also https://chromium-review.googlesource.com/c/catapult/+/1470852, which needs keystore stuff to sign the apk prior to installing (also in apk_helper.py). I assume that also makes you very uncomfortable as well, John ;)\n\nYep, it sure does :/",
      "parentUuid": "e98da102_3a7c7655",
      "range": {
        "startLine": 21,
        "startChar": 0,
        "endLine": 21,
        "endChar": 2
      },
      "revId": "d0071ded879eea94d26aafb348326a9cf3449dbd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c9993c19_6503ce63",
        "filename": "devil/devil/android/apk_helper.py",
        "patchSetId": 1
      },
      "lineNbr": 21,
      "author": {
        "id": 1154589
      },
      "writtenOn": "2019-02-15T18:05:53Z",
      "side": 1,
      "message": "So, as alluded to above, the new bundled build process creates a script in out/Release/bin/ that knows how to install the bundle. Would it make sense to devil to somehow plumb that script along with the .aab file itself, and use that to install?\n\nSee https://docs.google.com/document/d/1lSq0A2gjs__o1YY3K0u2yiEEPRj3PmkrZiP1wzUiP9E/edit?ts\u003d5c6200e2 for details.",
      "parentUuid": "c4900948_5db9dbb7",
      "range": {
        "startLine": 21,
        "startChar": 0,
        "endLine": 21,
        "endChar": 2
      },
      "revId": "d0071ded879eea94d26aafb348326a9cf3449dbd",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    }
  ]
}