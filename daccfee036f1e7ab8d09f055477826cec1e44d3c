{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "3ad4b3b6_11088d20",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1121710
      },
      "writtenOn": "2023-07-14T18:51:51Z",
      "side": 1,
      "message": "How can I test this?",
      "revId": "daccfee036f1e7ab8d09f055477826cec1e44d3c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c0dd1153_9733ef61",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1373330
      },
      "writtenOn": "2023-07-14T21:37:06Z",
      "side": 1,
      "message": "I tried to run the command under catapult/ and I can see similar error as in the cloud build:\n\nthird_party/catapult$ protoc -I dashboard/dashboard/protobuf --python_out dashboard/dashboard/sheriff_config dashboard/dashboard/protobuf/sheriff.proto dashboard/dashboard/protobuf/sheriff_config.proto \ndashboard/protobuf/sheriff.proto: File not found.\nsheriff_config.proto:7:1: Import \"dashboard/protobuf/sheriff.proto\" was not found or had errors.\nsheriff_config.proto:16:12: \"dashboard.Pattern\" seems to be defined in \"sheriff.proto\", which is not imported by \"sheriff_config.proto\".  To use it here, please add the necessary import.\nsheriff_config.proto:46:5: \"dashboard.Subscription\" seems to be defined in \"sheriff.proto\", which is not imported by \"sheriff_config.proto\".  To use it here, please add the necessary import.\nsheriff_config.proto:69:5: \"dashboard.Subscription\" seems to be defined in \"sheriff.proto\", which is not imported by \"sheriff_config.proto\".  To use it here, please add the necessary import.",
      "parentUuid": "3ad4b3b6_11088d20",
      "revId": "daccfee036f1e7ab8d09f055477826cec1e44d3c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a6e69ab8_ed2176d5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1373330
      },
      "writtenOn": "2023-07-14T21:57:10Z",
      "side": 1,
      "message": "For testing the trigger, I think we need similar changes on the traffic-.yaml files. So that changes on this yaml can trigger it. The current trigger will run a cloud build only when changes are in the sheriff_config folder.",
      "parentUuid": "c0dd1153_9733ef61",
      "revId": "daccfee036f1e7ab8d09f055477826cec1e44d3c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c04623df_b0847728",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1121710
      },
      "writtenOn": "2023-07-14T22:20:31Z",
      "side": 1,
      "message": "Sorry, I should have been more specific with my question: Is it possible to get cloud build to execute this .yaml file before submitting this CL?  \n\nOr is it not possible to have cloud build run this .yaml without landing it first? (I suppose it would be fine to land this just in order to test it, given that we can\u0027t break the current sheriff-config cloud builder any worse than it already is).\n\nRegarding the command you ran in your first comment: Were you trying to repro the original cloud build error locally, or were you trying to test the fix that\u0027s in this CL? Because what you ran doesn\u0027t test the fix in this CL. You saw the same error as cloud build because you ran the same parameters that cloud build currently uses.  This CL tries to fix that error by changing the -I flag to remove an unnecessary \u0027dashboard/protobuf\u0027 suffix from the protoc import path.\n\nTo test the fix for the problem (the one that\u0027s in this CL\u0027s latest patchset) on your workstation, I think you\u0027d need to run this (copy and paste it). Note the very slight difference in the `-I` flag between this and what you ran):\n\n```\nthird_party/catapult$ protoc -I dashboard --python_out dashboard/dashboard/sheriff_config dashboard/dashboard/protobuf/sheriff.proto dashboard/dashboard/protobuf/sheriff_config.proto\n```\n\nSwitching from `-I dashboard/dashboard/protobuf` to `-I dashboard` is the difference between protoc interpreting this line in `sheriff_config.proto`:\n\n`import \"dashboard/protobuf/sheriff.proto\";`\n\nto mean opening this file path (which doesn\u0027t exist in a catapult checkout root): \n\n  `./dashboard/dashboard/protobuf/dashboard/dashboard/protobuf/sheriff.proto`\n  \ninstead of this file path (which does exist in a catapult checkout root):\n\n  `./dashboard/dashboard/protobuf/sheriff.proto`\n  \nThis CL tries to make cloud build do the latter.",
      "parentUuid": "c0dd1153_9733ef61",
      "revId": "daccfee036f1e7ab8d09f055477826cec1e44d3c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "231b9b1b_d7211de0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1373330
      },
      "writtenOn": "2023-07-14T22:29:55Z",
      "side": 1,
      "message": "I see.\nI believe we can submit a build from local as in:\nhttps://cloud.google.com/build/docs/running-builds/submit-build-via-cli-api\nBut I don\u0027t think we can do it in prod. I tried that out in staging but failed last week, for deploying the default sevice:\nhttps://pantheon.corp.google.com/cloud-build/builds;region\u003dglobal/959ffaa8-8699-406c-894f-422750acaa3c?project\u003dchromeperf-stage",
      "parentUuid": "c04623df_b0847728",
      "revId": "daccfee036f1e7ab8d09f055477826cec1e44d3c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b6baf65c_16c4877c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1121710
      },
      "writtenOn": "2023-07-14T22:56:09Z",
      "side": 1,
      "message": "Thanks!\n\nOk I used the CLI from my workstation catapult checkout root like so:\n```\ngcloud builds submit --config dashboard/cloudbuild-sheriff-config-testing.yaml .\n```\n\nAnd that resulted in this cloud build attempt, which successfully executed step 0 and the `protoc` command that was failing before:\n\nhttps://pantheon.corp.google.com/cloud-build/builds/8848e79f-bd06-4ddb-851e-3160580eefd9?project\u003dchromeperf\u0026e\u003d-13802955\u0026mods\u003dcomponent_inspector\n\nNote that the overall build still fails, but now does so later on step 3. That appears to be due to reasons besides the protoc `-I` flag used in step 0 so I\u0027d address that in a separate CL.",
      "parentUuid": "231b9b1b_d7211de0",
      "revId": "daccfee036f1e7ab8d09f055477826cec1e44d3c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c5ce0458_b209bc47",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1373330
      },
      "writtenOn": "2023-07-14T23:29:54Z",
      "side": 1,
      "message": "Cool! Thanks!",
      "parentUuid": "b6baf65c_16c4877c",
      "revId": "daccfee036f1e7ab8d09f055477826cec1e44d3c",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}