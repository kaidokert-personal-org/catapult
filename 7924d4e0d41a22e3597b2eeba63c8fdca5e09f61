{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "878bfeb0_dce9ccdd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1521022
      },
      "writtenOn": "2022-09-08T23:51:37Z",
      "side": 1,
      "message": "In staging I wasn\u0027t able to verify that the POST commands would work for most handlers due to issues with the staging environment. I think there\u0027s some risk that some of these handlers will work and some of them will not. Navbar for example affects the navigational bar at the top of every page, so it could affect the entire website. \n\nIf we want to be conservative, we could start with:\n- main (we\u0027ve verified this works on staging), \n- graph_csv (easy to test feature, rarely used), \n- edit_site_config (also rarely used)\n\nAnd then bring the others along one by one. ",
      "revId": "7924d4e0d41a22e3597b2eeba63c8fdca5e09f61",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "51840764_5e013e4a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1181219
      },
      "writtenOn": "2022-09-09T17:34:16Z",
      "side": 1,
      "message": "While edit_site_config is rarely used, it is very important when it is needed. With the changes I just commented about elsewhere, edit_site_config now works using dev server.",
      "parentUuid": "878bfeb0_dce9ccdd",
      "revId": "7924d4e0d41a22e3597b2eeba63c8fdca5e09f61",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a5623c08_58238154",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1373330
      },
      "writtenOn": "2022-09-09T18:32:46Z",
      "side": 1,
      "message": "This seems a larger scope of change. I will trim down the change and leave the original CL owner to decide which one to enable to run in flask.",
      "parentUuid": "51840764_5e013e4a",
      "revId": "7924d4e0d41a22e3597b2eeba63c8fdca5e09f61",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "11704705_1d2438ef",
        "filename": "dashboard/dashboard/api/api_request_handler.py",
        "patchSetId": 2
      },
      "lineNbr": 17,
      "author": {
        "id": 1521022
      },
      "writtenOn": "2022-09-08T23:51:37Z",
      "side": 1,
      "message": "possible nit: not necessary?",
      "revId": "7924d4e0d41a22e3597b2eeba63c8fdca5e09f61",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ec6c60a7_c765841a",
        "filename": "dashboard/dashboard/api/api_request_handler.py",
        "patchSetId": 2
      },
      "lineNbr": 17,
      "author": {
        "id": 1373330
      },
      "writtenOn": "2022-09-09T18:32:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "11704705_1d2438ef",
      "revId": "7924d4e0d41a22e3597b2eeba63c8fdca5e09f61",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b0cb4042_3b698990",
        "filename": "dashboard/dashboard/api/api_request_handler.py",
        "patchSetId": 2
      },
      "lineNbr": 59,
      "author": {
        "id": 1181219
      },
      "writtenOn": "2022-09-08T22:57:11Z",
      "side": 1,
      "message": "Should we remove the \"if\", as in alerts.py?",
      "range": {
        "startLine": 59,
        "startChar": 0,
        "endLine": 59,
        "endChar": 8
      },
      "revId": "7924d4e0d41a22e3597b2eeba63c8fdca5e09f61",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "66b2078b_72fdba1a",
        "filename": "dashboard/dashboard/api/api_request_handler.py",
        "patchSetId": 2
      },
      "lineNbr": 59,
      "author": {
        "id": 1373330
      },
      "writtenOn": "2022-09-09T18:32:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b0cb4042_3b698990",
      "range": {
        "startLine": 59,
        "startChar": 0,
        "endLine": 59,
        "endChar": 8
      },
      "revId": "7924d4e0d41a22e3597b2eeba63c8fdca5e09f61",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5c537031_f4aa42a1",
        "filename": "dashboard/dashboard/dispatcher.py",
        "patchSetId": 2
      },
      "lineNbr": 205,
      "author": {
        "id": 1181219
      },
      "writtenOn": "2022-09-08T22:57:11Z",
      "side": 1,
      "message": "I encountered an issue with POST handler of this URL while testing on dev server. The @xsrf.TokenRequired decorator isn\u0027t working correctly with flask. Could you double check if it works on staging?",
      "range": {
        "startLine": 205,
        "startChar": 5,
        "endLine": 205,
        "endChar": 22
      },
      "revId": "7924d4e0d41a22e3597b2eeba63c8fdca5e09f61",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "93f89b6e_dbe5bbd6",
        "filename": "dashboard/dashboard/dispatcher.py",
        "patchSetId": 2
      },
      "lineNbr": 205,
      "author": {
        "id": 1521022
      },
      "writtenOn": "2022-09-08T23:51:37Z",
      "side": 1,
      "message": "Is it a similar issue as what you mentioned here? https://chromium-review.googlesource.com/c/catapult/+/3860021/comments/f3160708_4a21d241",
      "parentUuid": "5c537031_f4aa42a1",
      "range": {
        "startLine": 205,
        "startChar": 5,
        "endLine": 205,
        "endChar": 22
      },
      "revId": "7924d4e0d41a22e3597b2eeba63c8fdca5e09f61",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e1a99d2d_acdfd150",
        "filename": "dashboard/dashboard/dispatcher.py",
        "patchSetId": 2
      },
      "lineNbr": 205,
      "author": {
        "id": 1181219
      },
      "writtenOn": "2022-09-09T17:34:16Z",
      "side": 1,
      "message": "It\u0027s actually the same as the issue you mentioned at https://chromium-review.googlesource.com/c/catapult/+/3860021/comments/553e629b_0d220ed0\n\nThe problem is @xsrf.TokenRequired only works with webapp2, not with flask. See its implementation at https://source.chromium.org/chromium/chromium/src/+/main:third_party/catapult/dashboard/dashboard/common/xsrf.py;l\u003d54. The CheckToken method assumes there is a \"self\" argument, i.e., the wrapped function is a method inside a class. But this is only true in the case of webapp2, not flask. In addition, it retrieves the token with self.request.get, and that doesn\u0027t work with flask.\n\nThe easiest solution is to define a new TokenRequiredFlask decorator inside https://source.chromium.org/chromium/chromium/src/+/main:third_party/catapult/dashboard/dashboard/common/xsrf.py\n\nfrom flask import request\ndef TokenRequiredFlask(handler_method):\n  \"\"\"A decorator to require that the XSRF token be validated for the handler.\"\"\"\n  \n  def CheckToken(*args, **kwargs):\n    email \u003d utils.GetEmail()\n    token \u003d str(request.values.get(\u0027xsrf_token\u0027))\n    if not email or not _ValidateToken(token, email):\n      self.abort(403)\n    return handler_method(*args, **kwargs)\n\n  return CheckToken\n\nAnd then use @xsrf.TokenRequiredFlask to decorate flask functions.",
      "parentUuid": "93f89b6e_dbe5bbd6",
      "range": {
        "startLine": 205,
        "startChar": 5,
        "endLine": 205,
        "endChar": 22
      },
      "revId": "7924d4e0d41a22e3597b2eeba63c8fdca5e09f61",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "96c93e2f_bd872d2d",
        "filename": "dashboard/dashboard/dispatcher.py",
        "patchSetId": 2
      },
      "lineNbr": 205,
      "author": {
        "id": 1373330
      },
      "writtenOn": "2022-09-09T18:32:46Z",
      "side": 1,
      "message": "Will revert this change and limit the scope of this CL, as mentioned in another comment.",
      "parentUuid": "e1a99d2d_acdfd150",
      "range": {
        "startLine": 205,
        "startChar": 5,
        "endLine": 205,
        "endChar": 22
      },
      "revId": "7924d4e0d41a22e3597b2eeba63c8fdca5e09f61",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d1c7c74e_f007e527",
        "filename": "dashboard/dashboard/edit_site_config.py",
        "patchSetId": 2
      },
      "lineNbr": 75,
      "author": {
        "id": 1181219
      },
      "writtenOn": "2022-09-09T17:34:16Z",
      "side": 1,
      "message": "Need to use `values` in a POST handler.",
      "range": {
        "startLine": 75,
        "startChar": 16,
        "endLine": 75,
        "endChar": 20
      },
      "revId": "7924d4e0d41a22e3597b2eeba63c8fdca5e09f61",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3d3dadd6_6c2c9a88",
        "filename": "dashboard/dashboard/edit_site_config.py",
        "patchSetId": 2
      },
      "lineNbr": 75,
      "author": {
        "id": 1373330
      },
      "writtenOn": "2022-09-09T18:32:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d1c7c74e_f007e527",
      "range": {
        "startLine": 75,
        "startChar": 16,
        "endLine": 75,
        "endChar": 20
      },
      "revId": "7924d4e0d41a22e3597b2eeba63c8fdca5e09f61",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "eb454bc9_d3d3d8f8",
        "filename": "dashboard/dashboard/edit_site_config.py",
        "patchSetId": 2
      },
      "lineNbr": 88,
      "author": {
        "id": 1181219
      },
      "writtenOn": "2022-09-09T17:34:16Z",
      "side": 1,
      "message": "Replace args with values",
      "range": {
        "startLine": 86,
        "startChar": 0,
        "endLine": 88,
        "endChar": 70
      },
      "revId": "7924d4e0d41a22e3597b2eeba63c8fdca5e09f61",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "33605806_482ce98a",
        "filename": "dashboard/dashboard/edit_site_config.py",
        "patchSetId": 2
      },
      "lineNbr": 88,
      "author": {
        "id": 1373330
      },
      "writtenOn": "2022-09-09T18:32:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "eb454bc9_d3d3d8f8",
      "range": {
        "startLine": 86,
        "startChar": 0,
        "endLine": 88,
        "endChar": 70
      },
      "revId": "7924d4e0d41a22e3597b2eeba63c8fdca5e09f61",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba"
    }
  ]
}