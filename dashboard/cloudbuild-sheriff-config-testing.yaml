steps:
  # These are the testing and deploy steps for the sheriff-config service. This
  # works from the dashboard root and uses a combination of docker-compose and
  # other steps specific to the sheriff config build.
  - name: 'gcr.io/chromeperf/protoc'
    args: [
      '-I', 'dashboard/proto',
      '--python_out', 'dashboard/sheriff_config',
      'dashboard/proto/sheriff_config.proto'
    ]
  - name: 'docker/compose:1.19.0'
    args: [
      '-f', 'dashboard/sheriff_config/tests/docker-compose.yml', 'build'
    ]
  - name: 'docker/compose:1.19.0'
    args: [
      '-f', 'dashboard/sheriff_config/tests/docker-compose.yml',
      'up', '-d', 'datastore-emulator'
    ]
  - name: 'docker/compose:1.19.0'
    args: [
      '-f', 'dashboard/sheriff_config/tests/docker-compose.yml',
      'run', 'sheriff-config-test'
    ]
  - name: 'docker/compose:1.19.0'
    args: [
      '-f', 'dashboard/sheriff_config/tests/docker-compose.yml', 'down'
    ]
  - name: 'gcr.io/cloud-builders/gcloud'
    args: ['app', 'deploy', 'dashboard/sheriff_config/sheriff-config.yaml']
