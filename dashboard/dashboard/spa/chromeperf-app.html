<!DOCTYPE html>
<!--
Copyright 2018 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<link rel="import" href="/bower_components/app-route/app-location.html">
<link rel="import" href="/bower_components/app-route/app-route.html">
<link rel="import" href="/bower_components/google-signin/google-signin.html">
<link rel="import" href="/bower_components/iron-icons/communication-icons.html">
<link rel="import" href="/bower_components/iron-icons/editor-icons.html">
<link rel="import" href="/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/paper-input/paper-textarea.html">
<link rel="import" href="/bower_components/paper-progress/paper-progress.html">
<link rel="import" href="/bower_components/paper-toast/paper-toast.html">
<link rel="import" href="/dashboard/spa/alerts-section.html">
<link rel="import" href="/dashboard/spa/chart-section.html">
<link rel="import" href="/dashboard/spa/element-base.html">
<link rel="import" href="/dashboard/spa/pivot-section.html">
<link rel="import" href="/dashboard/spa/report-section.html">
<link rel="import" href="/dashboard/spa/session-ids.html">
<link rel="import" href="/dashboard/spa/test-suites.html">
<link rel="import" href="/tracing/base/guid.html">

<dom-module id="chromeperf-app">
  <template>
    <style>
      :host {
        /* https://material.io/guidelines/motion/material-motion.html#material-motion-how-does-material-move */
        --transition-long: 0.4s;
        --transition-short: 0.2s;
      }

      #nav {
        align-items: center;
        display: flex;
        padding: 4px 0;
        width: 100%;
        white-space: nowrap;
      }

      #title {
        font-size: large;
        line-height: 27px; /* match height of google-signin */
        padding: 8px;
        text-decoration: none;
      }

      iron-icon {
        margin: 0 4px;
      }

      .spacer {
        flex-grow: 1;
        margin: auto;
      }

      #nav a {
        color: var(--paper-indigo-500);
      }

      google-signin {
        margin: 0;
        padding: 8px;
      }

      paper-progress {
        --paper-progress-active-color: var(--paper-indigo-500);
        --paper-progress-container-color: white;
        width: 100%;
      }

      report-section,
      alerts-section,
      chart-section {
        display: block;
        margin: 0;
        padding: 16px;
      }

      #nav,
      report-section,
      alerts-section,
      chart-section {
        /* Use full-bleed dividers between sections.
           https://material.io/guidelines/components/dividers.html
         */
        border-bottom: 1px solid var(--paper-indigo-100);
      }

      .buttons paper-button {
        background-color: var(--paper-indigo-50);
        color: var(--paper-indigo-500);
        border-radius: 24px;
        display: block;
        margin: 4px 8px;
        padding: 4px 8px;
        text-align: center;
        flex-grow: 1;
      }

      paper-button[disabled] {
        background-color: var(--paper-grey-100);
        color: var(--paper-grey-500);
      }

      .buttons {
        margin: 0 8px;
        display: flex;
        justify-content: space-evenly;
      }

      .bottom.buttons {
        margin-top: 12px;
      }

      #please_signin {
        color: var(--paper-red-500);
        font-size: larger;
        font-weight: bold;
      }

      #reopen_chart {
        text-transform: none;
      }

      @media (max-width: 1100px) {
        .nav_button_label {
          display: none;
        }
      }
    </style>

    <app-route route="{{route}}"></app-route>
    <app-location route="{{route}}" use-hash-as-path></app-location>

    <div id="nav">
      <a href="/" id="title" on-tap="onReset_">
        Chromeperf Dashboard
      </a>

      <span class="spacer"></span>

      <div class="buttons">
        <paper-button
            raised
            title="Open Report"
            disabled="[[showingReportSection]]"
            on-tap="onShowReportSection_">
          <iron-icon icon="communication:business">
          </iron-icon>
          Report
        </paper-button>

        <paper-button
            raised
            title="New Alerts section"
            on-tap="onNewAlertsSection_">
          <iron-icon icon="add-alert">
          </iron-icon>
          <span class="nav_button_label">
            Alerts
          </span>
        </paper-button>

        <paper-button
            raised
            title="New Chart"
            on-tap="onNewChart_">
          <iron-icon icon="editor:show-chart">
          </iron-icon>
          <span class="nav_button_label">
            New Chart
          </span>
        </paper-button>

        <paper-button
            raised
            title="Close all charts"
            disabled="[[!_multiple(chartSectionIds)]]"
            on-tap="onCloseAllCharts_">
          <iron-icon icon="close">
          </iron-icon>
          <span class="nav_button_label">
            Close charts
          </span>
        </paper-button>
      </div>

      <span class="spacer"></span>

      <a href="https://github.com/catapult-project/catapult/tree/master/dashboard"
         target="_blank"
         title="Documentation">
        <paper-icon-button icon="help">
        </paper-icon-button>
      </a>

      <template is="dom-if" if="[[isInternal_(userEmail)]]">
        <a href="http://go/chromeperf-v2-status"
           target="_blank"
           title="Status of this prototype">
          <paper-icon-button icon="update">
          </paper-icon-button>
        </a>
      </template>

      <a href$="https://bugs.chromium.org/p/chromium/issues/entry?description=Describe+the+problem:+%0A%0A%0AURL:+[[escapedUrl_(route.path)]]&comment=&summary=[chromeperf2]+"
         target="_blank"
         title="File a bug">
        <paper-icon-button icon="feedback">
        </paper-icon-button>
      </a>

      <template is="dom-if" if="[[isProduction]]">
        <template is="dom-if" if="[[!userEmail]]">
          <span id="please_signin">
            Some features require signing in:
          </span>
        </template>
        [[userEmail]]

        <google-signin
            id="signin"
            client-id="[[clientId]]"
            height="short"
            theme="dark"
            scopes="email"
            on-google-signin-success="onSignin_"
            on-google-signed-out="onSignout_">
        </google-signin>
      </template>
    </div>

    <paper-progress indeterminate="[[isLoading]]">
    </paper-progress>

    <template is="dom-if" if="[[reportSection]]">
      <iron-collapse opened="[[showingReportSection]]">
        <report-section
            state-path="[[statePath]].reportSection"
            on-require-sign-in="requireSignIn_"
            on-close-section="hideReportSection_"
            on-alerts="onReportAlerts_"
            on-new-chart="onNewChart_">
        </report-section>
      </iron-collapse>
    </template>

    <template is="dom-repeat" items="[[alertsSectionIds]]" as="id" index-as="idIndex">
      <alerts-section
          state-path="[[statePath]].alertsSectionsById.[[id]]"
          linked-state-path="[[statePath]].linkedChartState"
          on-require-sign-in="requireSignIn_"
          on-new-chart="onNewChart_"
          on-close-section="onCloseAlerts_">
      </alerts-section>
    </template>

    <template is="dom-repeat" items="[[chartSectionIds]]" as="id" index-as="idIndex">
      <chart-section
          state-path="[[statePath]].chartSectionsById.[[id]]"
          linked-state-path="[[statePath]].linkedChartState"
          on-require-sign-in="requireSignIn_"
          on-new-chart="onNewChart_"
          on-close-section="onCloseChart_">
      </chart-section>
    </template>

    <template is="dom-if" if="[[showBottomButtons_(showingReportSection, alertsSectionIds, chartSectionIds)]]">
      <div class="buttons bottom">
        <span class="spacer"></span>

        <paper-button
            raised
            title="New Alerts section"
            on-tap="onNewAlertsSection_">
          <iron-icon icon="add-alert">
          </iron-icon>
          Alerts
        </paper-button>

        <paper-button
            raised
            title="New Chart"
            on-tap="onNewChart_">
          <iron-icon icon="editor:show-chart">
          </iron-icon>
          New Chart
        </paper-button>

        <paper-button
            raised
            title="Close all charts"
            disabled="[[!_multiple(chartSectionIds)]]"
            on-tap="onCloseAllCharts_">
          <iron-icon icon="close">
          </iron-icon>
          Close charts
        </paper-button>

        <span class="spacer"></span>
      </div>
    </template>

    <span style="color: grey;">
      [[vulcanizedDate]]
    </span>

    <paper-toast opened="[[closedAlertsIds]]">
      <paper-button
          id="reopen_alerts"
          on-tap="onReopenClosedAlerts_">
        Reopen [[getAlertsTitle_(closedAlertsIds)]]
      </paper-button>
    </paper-toast>

    <paper-toast opened="[[closedChartIds]]">
      <paper-button
          id="reopen_chart"
          on-tap="onReopenClosedChart_">
        Reopen [[getChartTitle_(closedChartIds)]]
      </paper-button>
    </paper-toast>
  </template>
</dom-module>
<script src="/dashboard/spa/chromeperf-app.js"></script>
