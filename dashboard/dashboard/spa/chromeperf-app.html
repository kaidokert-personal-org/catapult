<!DOCTYPE html>
<!--
Copyright 2018 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<link rel="import" href="/bower_components/app-route/app-location.html">
<link rel="import" href="/bower_components/app-route/app-route.html">
<link rel="import" href="/bower_components/google-signin/google-signin.html">
<link rel="import" href="/dashboard/spa/alerts-section.html">
<link rel="import" href="/dashboard/spa/chart-section.html">
<link rel="import" href="/dashboard/spa/cp-icons.html">
<link rel="import" href="/dashboard/spa/cp-loading.html">
<link rel="import" href="/dashboard/spa/cp-toast.html">
<link rel="import" href="/dashboard/spa/element-base.html">
<link rel="import" href="/dashboard/spa/pivot-section.html">
<link rel="import" href="/dashboard/spa/raised-button.html">
<link rel="import" href="/dashboard/spa/report-section.html">
<link rel="import" href="/dashboard/spa/test-suites.html">
<link rel="import" href="/tracing/base/guid.html">

<dom-module id="chromeperf-app">
  <template>
    <style>
      #nav {
        align-items: center;
        display: flex;
        padding: 4px 0;
        width: 100%;
        white-space: nowrap;
      }

      #title {
        font-size: large;
        line-height: 27px; /* match height of google-signin */
        padding: 8px;
        text-decoration: none;
      }

      iron-icon {
        margin: 0 4px;
      }

      .spacer {
        flex-grow: 1;
        margin: auto;
      }

      #nav a {
        color: var(--primary-color-dark);
      }

      google-signin {
        margin: 0;
        padding: 8px;
      }

      report-section,
      alerts-section,
      chart-section {
        display: block;
        margin: 0;
        padding: 16px;
      }

      #nav,
      report-section,
      alerts-section,
      chart-section {
        /* Use full-bleed dividers between sections.
           https://material.io/guidelines/components/dividers.html
         */
        border-bottom: 1px solid var(--primary-color-medium);
      }

      .buttons {
        display: flex;
        justify-content: space-evenly;
      }

      .bottom.buttons {
        margin: 12px 0;
      }
      .bottom.buttons raised-button {
        flex-grow: 1;
      }

      #please_signin {
        color: var(--error-color);
        font-size: larger;
        font-weight: bold;
      }

      cp-toast {
        border-radius: 24px;
        cursor: pointer;
        text-transform: uppercase;
        user-select: none;
      }

      cp-toast iron-icon {
        color: var(--background-color, white);
      }

      @media (max-width: 1100px) {
        .nav_button_label {
          display: none;
        }
      }
    </style>

    <app-route route="{{route}}"></app-route>
    <app-location route="{{route}}" use-hash-as-path></app-location>

    <template is="dom-if" if="[[enableNav]]">
      <div id="nav">
        <a href="/" id="title" on-click="onReset_">
          Chromium Performance
        </a>

        <span class="spacer"></span>

        <div class="buttons">
          <raised-button
              title="Open Report"
              disabled$="[[showingReportSection]]"
              on-click="onShowReportSection_">
            <iron-icon icon="cp:report">
            </iron-icon>
            Report
          </raised-button>

          <raised-button
              title="New Alerts section"
              on-click="onNewAlertsSection_">
            <iron-icon icon="cp:alert">
            </iron-icon>
            <span class="nav_button_label">
              Alerts
            </span>
          </raised-button>

          <raised-button
              title="New Chart"
              on-click="onNewChart_">
            <iron-icon icon="cp:chart">
            </iron-icon>
            <span class="nav_button_label">
              New Chart
            </span>
          </raised-button>

          <raised-button
              title="Close all charts"
              disabled$="[[isEmpty_(chartSectionIds)]]"
              on-click="onCloseAllCharts_">
            <iron-icon icon="cp:close">
            </iron-icon>
            <span class="nav_button_label">
              Close charts
            </span>
          </raised-button>
        </div>

        <span class="spacer"></span>

        <a href="https://github.com/catapult-project/catapult/tree/master/dashboard"
            target="_blank"
            title="Documentation">
          <iron-icon icon="cp:help">
          </iron-icon>
        </a>

        <template is="dom-if" if="[[isInternal_(userEmail)]]">
          <a href="http://go/chromeperf-v2-status"
              target="_blank"
              title="Status of this prototype">
            <iron-icon icon="cp:update">
            </iron-icon>
          </a>
        </template>

        <a href$="https://bugs.chromium.org/p/chromium/issues/entry?description=Describe+the+problem:+%0A%0A%0AURL:+[[escapedUrl_(route.path)]]&components=Speed%3EDashboard&summary=[chromeperf2]+"
            target="_blank"
            title="File a bug">
          <iron-icon icon="cp:feedback">
          </iron-icon>
        </a>

        <template is="dom-if" if="[[isProduction]]">
          <template is="dom-if" if="[[!userEmail]]">
            <span id="please_signin">
              Some features require signing in:
            </span>
          </template>
          [[userEmail]]

          <google-signin
              id="signin"
              client-id="[[clientId]]"
              height="short"
              theme="dark"
              scopes="email"
              on-google-signin-success="onSignin_"
              on-google-signed-out="onSignout_">
          </google-signin>
        </template>
      </div>
    </template>

    <cp-loading loading$="[[isLoading]]"></cp-loading>

    <template is="dom-if" if="[[reportSection]]">
      <iron-collapse opened="[[showingReportSection]]">
        <report-section
            state-path="[[statePath]].reportSection"
            on-require-sign-in="requireSignIn_"
            on-close-section="hideReportSection_"
            on-alerts="onReportAlerts_"
            on-new-chart="onNewChart_">
        </report-section>
      </iron-collapse>
    </template>

    <template is="dom-repeat" items="[[alertsSectionIds]]" as="id" index-as="idIndex">
      <alerts-section
          state-path="[[statePath]].alertsSectionsById.[[id]]"
          linked-state-path="[[statePath]].linkedChartState"
          on-require-sign-in="requireSignIn_"
          on-new-chart="onNewChart_"
          on-close-section="onCloseAlerts_">
      </alerts-section>
    </template>

    <template is="dom-repeat" items="[[chartSectionIds]]" as="id" index-as="idIndex">
      <chart-section
          state-path="[[statePath]].chartSectionsById.[[id]]"
          linked-state-path="[[statePath]].linkedChartState"
          on-require-sign-in="requireSignIn_"
          on-new-chart="onNewChart_"
          on-close-section="onCloseChart_">
      </chart-section>
    </template>

    <template is="dom-if" if="[[showBottomButtons_(enableNav, showingReportSection, alertsSectionIds, chartSectionIds)]]">
      <div class="buttons bottom">
        <span class="spacer"></span>

        <raised-button
            title="New Alerts section"
            on-click="onNewAlertsSection_">
          <iron-icon icon="cp:alert">
          </iron-icon>
          Alerts
        </raised-button>

        <raised-button
            title="New Chart"
            on-click="onNewChart_">
          <iron-icon icon="cp:chart">
          </iron-icon>
          New Chart
        </raised-button>

        <raised-button
            title="Close all charts"
            disabled$="[[isEmpty_(chartSectionIds)]]"
            on-click="onCloseAllCharts_">
          <iron-icon icon="cp:close">
          </iron-icon>
          Close charts
        </raised-button>

        <span class="spacer"></span>
      </div>
    </template>

    <span style="color: grey;">
      [[vulcanizedDate]]
    </span>

    <cp-toast opened="[[closedAlertsIds]]" on-click="onReopenClosedAlerts_">
      <iron-icon icon="cp:alert">
      </iron-icon>
      Reopen alerts
    </cp-toast>

    <cp-toast opened="[[closedChartIds]]" on-click="onReopenClosedChart_">
      <iron-icon icon="cp:chart">
      </iron-icon>
      Reopen chart
    </cp-toast>
  </template>
</dom-module>
<script src="/dashboard/spa/chromeperf-app.js"></script>
