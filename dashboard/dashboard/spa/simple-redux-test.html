<!DOCTYPE html>
<!--
Copyright 2018 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<link rel="import" href="/dashboard/spa/simple-redux.html">
<link rel="import" href="/tracing/core/test_utils.html">

<script>
'use strict';
tr.b.unittest.testSuite(function() {
  test('renameReducer', function() {
    function cer() {}
    const renamer = Redux.renameReducer('redu');
    renamer(cer);
    assert.strictEqual('reducer', cer.name);
  });

  test('registerReducer', function() {
    function testRegisterReducer(state, action) {
      return {...state, test: action.testValue};
    }
    Redux.registerReducer(testRegisterReducer);
    const store = Redux.createSimpleStore();
    store.dispatch({type: testRegisterReducer.name, testValue: 42});
    assert.strictEqual(42, store.getState().test);
  });

  test('statePathReducer', function() {
    const reducer = Redux.statePathReducer((localState, action, rootState) => {
      return {...localState, test: action.testValue};
    });
    assert.deepEqual({a: [{b: {pre: 1, test: 'c'}}]}, reducer(
        {a: [{b: {pre: 1}}]}, {statePath: 'a.0.b', testValue: 'c'}));
  });

  test('freezingReducer', function() {
    const reducer = Redux.freezingReducer((state, action) => {
      state.modification = 'error';
    });
    assert.throws(() => reducer({}, {}));
  });

  test('thunk', function() {
    const store = Redux.createSimpleStore();
    const actionCreator = (testValue) => (dispatch, getState) => {
      dispatch({type: 'UPDATE', delta: {testValue}});
    };
    store.dispatch(actionCreator(42));
    assert.strictEqual(42, store.getState().testValue);
  });

  test('UPDATE', function() {
    const store = Redux.createSimpleStore();
    store.dispatch({type: 'UPDATE', statePath: 'a', delta: {testValue: 42}});
    assert.strictEqual(42, store.getState().a.testValue);
  });

  test('TOGGLE', function() {
    const store = Redux.createSimpleStore({defaultState: {testValue: false}});
    store.dispatch({type: 'TOGGLE', statePath: 'testValue'});
    assert.isTrue(store.getState().testValue);
  });
});
</script>
