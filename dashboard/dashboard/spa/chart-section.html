<!DOCTYPE html>
<!--
Copyright 2017 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/dashboard/spa/line-chart.html">
<link rel="import" href="/dashboard/spa/chart-placeholder.html">
<link rel="import" href="/dashboard/spa/test-path-component.html">
<link rel="import" href="/tracing/value/ui/histogram_set_view.html">

<dom-module id="chart-section">
  <template>
    <style>
      #controls {
        display: flex;
        margin-bottom: 1em;
      }

      test-path-component {
        margin-right: 1em;
      }

      #loading_spinner {
        visibility: hidden;
        flex-shrink: 0;
      }

      #loading_spinner[active] {
        visibility: visible;
      }

      #title {
        flex-grow: 1;
      }

      #spacer {
        flex-grow: 1;
      }

      #description {
        margin-bottom: 1em;
      }

      #minimap, #chart {
        width: 100%;
      }

      #toggle_chart_only {
        display: block;
        min-width: 0;
        padding: 8px;
        margin: 0;
      }

      #close {
        flex-shrink: 0;
      }

      #chart_container {
        display: flex;
        height: 290px;
      }

      #chart_container div {
        flex-grow: 1;
        margin-right: 1em;
      }

      #histograms {
        max-height: 290px;
        overflow-y: auto;
      }
    </style>

    <div id="controls">
      <template is="dom-if" if="[[!onlyChart]]">
        <template is="dom-repeat" items="[[testPathComponents]]">
          <test-path-component section-id="[[sectionId]]"
                                component-index="[[index]]">
          </test-path-component>
        </template>
      </template>

      <template is="dom-if" if="[[onlyChart]]">
        <paper-input id="title"
                     value="[[title]]"
                     label="Title"
                     on-keyup="onTitleKeydown_">
        </paper-input>
      </template>

      <paper-spinner id="loading_spinner"
                     active$="[[isLoading]]">
      </paper-spinner>

      <template is="dom-if" if="[[!onlyChart]]">
        <span id="spacer">&nbsp;</span>
      </template>

      <paper-button id="toggle_chart_only"
                    on-tap="toggleChartOnly_">
        <template is="dom-if" if="[[onlyChart]]">
          <iron-icon icon="expand-more">
          </iron-icon>
        </template>
        <template is="dom-if" if="[[!onlyChart]]">
          <iron-icon icon="expand-less">
          </iron-icon>
        </template>
      </paper-button>

      <paper-icon-button id="close"
                         icon="close"
                         on-tap="closeSection_">
      </paper-icon-button>
    </div>

    <div id="description">
      <template is="dom-if" if="[[!onlyChart]]">
        [[testSuiteDescription]]
      </template>
    </div>

    <div id="chart_container">
      <div>
        <template is="dom-if" if="[[chartLayout]]">
          <template is="dom-if" if="[[!onlyChart]]">
            <line-chart id="minimap"
                        layout="[[minimapLayout]]"
                        on-brush-handle-down="onMinimapBrushHandleDown_"
                        on-brush-handle-move="onMinimapBrushHandleMove_"
                        on-brush-handle-up="onMinimapBrushHandleUp_">
            </line-chart>
          </template>

          <line-chart id="chart"
                      layout="[[chartLayout]]"
                      on-dot-click="onDotClick_"
                      on-dot-mouseover="onDotMouseOver_"
                      on-dot-mouseout="onDotMouseOut_"
                      on-brush-handle-down="onBrushHandleDown_"
                      on-brush-handle-move="onBrushHandleMove_"
                      on-brush-handle-up="onBrushHandleUp_">
          </line-chart>
        </template>

        <template is="dom-if" if="[[!chartLayout]]">
          <chart-placeholder/>
        </template>
      </div>

      <template is="dom-if" if="[[!onlyChart]]">
        <template is="dom-if" if="[[!_empty(histograms)]]">
          <tr-v-ui-histogram-set-view id="histograms"
                                      histograms="[[histograms]]">
          </tr-v-ui-histogram-set-view>
        </template>
      </template>
    </div>
    <!-- TODO related sparklines tabs -->
  </template>
</dom-module>

<script src="/dashboard/spa/chart-section.js"></script>
