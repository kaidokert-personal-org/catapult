<!DOCTYPE html>
<!--
Copyright 2017 The Chromium Authors. All rights reserved.
Use of this source code is governed by a BSD-style license that can be
found in the LICENSE file.
-->

<dom-module id="line-chart">
  <template>
    <style>
      :host {
        display: flex;
      }

      #right {
        display: flex;
        flex-direction: column;
        flex-grow: 1;
      }

      #brush_handles {
        position: relative;
        height: 15px;
      }

      #brush_handles svg {
        position: absolute;
      }

      path {
        vector-effect: non-scaling-stroke;
      }

      rect {
        opacity: 0.05;
      }

      #yaxis {
        margin-right: 3px;
        margin-top: 15px;
      }

      #xaxis {
        margin-top: 3px;
      }

      line {
        stroke-width: 1;
        stroke: #ccc;
      }

      circle:hover {
        opacity: 1;
      }
    </style>

    <svg id="yaxis"
          width$="[[layout.yAxisWidth]]"
          height$="[[layout.height]]">
      <template is="dom-repeat" items="[[layout.yAxisTicks]]" as="tick">
        <text x$="[[tick.x]]"
              y$="[[tick.y]]"
              alignment-baseline="middle">
          [[tick.text]]
        </text>
      </template>
    </svg>

    <div id="right">
      <div id="brush_handles">
        <template is="dom-repeat" items="[[layout.antiBrushes]]" as="antiBrush">
          <template is="dom-if" if="[[antiBrush.leftHandle]]">
            <svg height="15" style$="left: calc([[antiBrush.x]] - 5px)">
              <path d="M0,0 L10,0 L10,10 L5,15 L0,10"
                    fill="rgba(0, 0, 0, 0.3)"
                    cursor="move"
                    on-mousedown="onBrushHandleMouseDown_"
                    on-mousemove="onBrushHandleMouseMove_"
                    on-mouseup="onBrushHandleMouseUp_">
              </path>
            </svg>
          </template>

          <template is="dom-if" if="[[antiBrush.rightHandle]]">
            <svg height="15" style$="left: calc([[antiBrush.right]] - 5px)">
              <path d="M0,0 L10,0 L10,10 L5,15 L0,10"
                    fill="rgba(0, 0, 0, 0.3)"
                    cursor="move"
                    on-mousedown="onBrushHandleMouseDown_"
                    on-mousemove="onBrushHandleMouseMove_"
                    on-mouseup="onBrushHandleMouseUp_">
              </path>
            </svg>
          </template>
        </template>
      </div>

      <svg id="main"
           width="100%"
           height$="[[layout.graphHeight]]"
           preserveAspectRatio="none">
        <template is="dom-if" if="[[layout.showYAxisTickLines]]">
          <template is="dom-repeat" items="[[layout.yAxisTicks]]" as="tick">
            <line x1="0"
                  x2="100%"
                  y1$="[[tick.y]]"
                  y2$="[[tick.y]]">
            </line>
          </template>
        </template>

        <template is="dom-if" if="[[layout.showXAxisTickLines]]">
          <template is="dom-repeat" items="[[layout.xAxisTicks]]" as="tick">
            <line x1$="[[tick.x]]"
                  x2$="[[tick.x]]"
                  y1="0"
                  y2="100%">
            </line>
          </template>
        </template>

        <template is="dom-repeat" items="[[layout.antiBrushes]]" as="antiBrush">
          <rect x$="[[antiBrush.x]]"
                y="0"
                width$="[[antiBrush.width]]"
                height="100%">
          </rect>
        </template>

        <template is="dom-repeat" items="[[layout.sequences]]" as="sequence">
          <svg viewBox="0 0 100 100"
               x="0"
               width="100%"
               y="0"
               height="100%"
               preserveAspectRatio="none">
            <path d$="[[sequence.path]]"
                  stroke$="[[sequence.color]]"
                  fill="none">
            </path>
          </svg>
        </template>

        <template is="dom-repeat" items="[[layout.sequences]]" as="sequence">
          <template is="dom-repeat" items="[[sequence.data]]" as="datum">
            <circle cx$="[[datum.x]]"
                    cy$="[[datum.y]]"
                    r$="[[layout.dotRadius]]"
                    fill$="[[sequence.dotColor]]"
                    cursor$="[[layout.dotCursor]]"
                    opacity="0"
                    on-tap="onDotClick_"
                    on-mouseover="onDotMouseOver_"
                    on-mouseout="onDotMouseOut_">
            </circle>

            <template is="dom-repeat" items="[[datum.icons]]" as="icon">
              <!-- TODO -->
            </template>
          </template>
        </template>
      </svg>

      <svg id="xaxis"
           width="100%"
           height$="[[layout.xAxisHeight]]">
        <template is="dom-repeat" items="[[layout.xAxisTicks]]" as="tick">
          <text x$="[[tick.x]]"
                y="0"
                text-anchor="middle"
                alignment-baseline="hanging">
            [[tick.text]]
          </text>
        </template>
      </svg>
    </div>
  </template>
</dom-module>

<script src="/dashboard/spa/line-chart.js"></script>
